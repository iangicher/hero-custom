<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>Template Plugins | Hero User Guide</title>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
		<script type="text/javascript" src="./../js/shCore.js"></script>
		<script type="text/javascript" src="./../js/shBrushPhp.js"></script>
		<script type="text/javascript" src="./../js/shBrushXml.js"></script>
		<script type="text/javascript" src="./../js/user_guide.js"></script>
		<link href="./../css/user_guide.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="./../css/shCore.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="./../css/shThemeDefault.css" media="screen" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div class="header">
			Hero <span class="sub">/ User Guide</span>
		</div>
		<div class="body">
			<div id="navigation">
				<ul>
					<li>
						<a rel="basic" class="parent" href="#">Basic Details</a>
						<ul>
							<li>
								<a href="./../index.html">Welcome to Hero</a>
							</li>
							<li>
								<a href="./../license.html">License Agreement</a>
							</li>
							<li>
								<a href="./../changelog.html">Changelog</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="installation" class="parent" href="#">Installation</a>
						<ul>
							<li>
								<a href="./../installation/server_requirements.html">Server Requirements</a>
							</li>
							<li>
								<a href="./../installation/installation.html">Fresh Installation</a>
							</li>
							<li>
								<a href="./../installation/upgrading.html">Upgrading</a>
							</li>
							<li>
								<a href="./../installation/migration.html">Migration</a>
							</li>
							<li>
								<a href="./../installation/troubleshooting.html">Troubleshooting</a>
							</li>
							<li>
								<a href="./../installation/deployment.html">Mass Deployment</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="configuration" class="parent" href="#">Configuration</a>
						<ul>
							<li>
								<a href="./../configuration/settings.html">Settings</a>
							</li>
							<li>
								<a href="./../configuration/coupon_codes.html">Coupon Codes</a>
							</li>
							<li>
								<a href="./../configuration/branding.html">Custom Branding</a>
							</li>
							<li>
								<a href="./../configuration/custom_fields.html">Custom Fields</a>
							</li>
							<li>
								<a href="./../configuration/emails.html">Emails</a>
							</li>
							<li>
								<a href="./../configuration/importing_members.html">Importing Members</a>
							</li>
							<li>
								<a href="./../configuration/member_groups.html">Member Groups</a>
							</li>
							<li>
								<a href="./../configuration/payment_gateways.html">Payment Gateways</a>
							</li>
							<li>
								<a href="./../configuration/reports.html">Reports</a>
							</li>
							<li>
								<a href="./../configuration/search.html">Search</a>
							</li>
							<li>
								<a href="./../configuration/security.html">Security</a>
							</li>
							<li>
								<a href="./../configuration/shipping.html">Shipping Rates</a>
							</li>
							<li>
								<a href="./../configuration/subscriptions.html">Subscriptions</a>
							</li>
							<li>
								<a href="./../configuration/taxes.html">Taxes</a>
							</li>
							<li>
								<a href="./../configuration/advanced.html">Advanced</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="publishing" class="parent" href="#">Publishing</a>
						<ul>
							<li><a href="./../publishing/blogs.html">Blogs</a></li>
							<li><a href="./../publishing/content.html">Content &amp; Content Types</a></li>
							<li><a href="./../publishing/forms.html">Forms</a></li>
							<li><a href="./../publishing/menus.html">Navigation Menus</a></li>
							<li><a href="./../publishing/rss_feeds.html">RSS Feeds</a></li>
							<li><a href="./../publishing/store.html">Store Products &amp; Collections</a>
							<li><a href="./../publishing/topics.html">Topics</a></li>
						</ul>
					</li>
					<li>
						<a rel="designers" class="parent" href="#">Designing</a>
						<ul>
							<li><a href="./../designers/index.html">Designer Introduction</a></li>
							<li><a href="./../designers/smarty.html">Smarty Template Engine</a></li>
							<li><a href="./../designers/includes.html">Stylesheets &amp; JavaScript</a></li>
							<li><a href="./../designers/template_plugins.html">Template Plugins</a></li>
							<li><a href="./../designers/mapping_urls.html">Mapping URL's</a></li>
							<li class="reference">Reference</li>
							<li class="reference"><a href="./../designers/reference/global_variables.html">Global Variables</a></li>
							<li class="reference"><a href="./../designers/reference/global_plugins.html">Global Plugins</a></li>
							<li class="reference"><a href="./../designers/reference/blogs.html">Blogs &amp; Archives</a></li>
							<li class="reference"><a href="./../designers/reference/custom_fields.html">Custom Fields</a></li>
							<li class="reference"><a href="./../designers/reference/forms.html">Forms</a></li>
							<li class="reference"><a href="./../designers/reference/members.html">Members</a></li>
							<li class="reference"><a href="./../designers/reference/menus.html">Navigation Menus</a></li>
							<li class="reference"><a href="./../designers/reference/paywall_privileges.html">Access Restrictions &amp; Paywalls</a></li>
							<li class="reference"><a href="./../designers/reference/publish.html">Published Content &amp; Topics</a></li>
							<li class="reference"><a href="./../designers/reference/rss_feeds.html">RSS Feeds</a></li>
							<li class="reference"><a href="./../designers/reference/search.html">Search Forms &amp; Results</a></li>
							<li class="reference"><a href="./../designers/reference/store.html">Store Products &amp; Collections</a></li>
							<li class="reference"><a href="./../designers/reference/subscriptions.html">Subscriptions</a></li>
							<li class="reference"><a href="./../designers/reference/custom_fields.html">Custom Fields</a></li>
						</ul>
					</li>
					<li>
						<a rel="developers" class="parent active" href="#">Developing</a>
						<ul>
							<li><a href="./../developers/index.html">Developer Introduction</a></li>
							<li><a href="./../developers/codeigniter.html">CodeIgniter</a></li>
							<li><a href="./../developers/standards.html">Standards &amp; Best Practices</a></li>
							<li><a href="./../developers/security.html">Security</a></li>
							<li><a href="./../developers/modules.html">Module Development</a></li>
							<li><a href="./../developers/template_plugins.html">Template Plugin Development</a></li>
							<li><a href="./../developers/cronjobs.html">Cronjobs &amp; Automated Processes</a></li>
							<li><a href="./../developers/forms.html">Forms &amp; Custom Fieldtypes</a></li>
							<li><a href="./../developers/errors_logging.html">Errors &amp; Logging</a></li>
							<li><a href="./../developers/profiling.html">Debug/Profile Mode</a></li>
							<li class="reference">Reference</li>
							<li class="reference"><a href="./../developers/reference/admin_form_library.html">Admin Form Library</a></li> 
							<li class="reference"><a href="./../developers/reference/admin_navigation_library.html">Admin Navigation Library</a></li> 
							<li class="reference"><a href="./../developers/reference/app_hooks_library.html">App Hooks Library</a></li>
							<li class="reference"><a href="./../developers/reference/array_to_csv_library.html">Array to CSV Library</a></li> 
							<li class="reference"><a href="./../developers/reference/array_to_json_helper.html">Array to JSON Helper</a></li> 
							<li class="reference"><a href="./../developers/reference/blog_model.html">Blog Model</a></li> 
							<li class="reference"><a href="./../developers/reference/cart_model.html">Cart Model</a></li> 
							<li class="reference"><a href="./../developers/reference/clean_string_helper.html">Clean String Helper</a></li> 
							<li class="reference"><a href="./../developers/reference/collections_model.html">Collections Model</a></li> 
							<li class="reference"><a href="./../developers/reference/content_model.html">Content Model</a></li>
							<li class="reference"><a href="./../developers/reference/content_type_model.html">Content Type Model</a></li>  
							<li class="reference"><a href="./../developers/reference/coupon_model.html">Coupon Model</a></li> 
							<li class="reference"><a href="./../developers/reference/custom_fields_model.html">Custom Fields Model</a></li> 
							<li class="reference"><a href="./../developers/reference/dataset_library.html">Dataset Library</a></li> 
							<li class="reference"><a href="./../developers/reference/email_model.html">Email Model</a></li> 
							<li class="reference"><a href="./../developers/reference/fieldtype_library.html">Fieldtype Library</a></li> 
							<li class="reference"><a href="./../developers/reference/form_builder_library.html">Form Builder Library</a></li> 
							<li class="reference"><a href="./../developers/reference/form_model.html">Form Model</a></li> 
							<li class="reference"><a href="./../developers/reference/image_thumb_helper.html">Image Thumb Helper</a></li>
							<li class="reference"><a href="./../developers/reference/invoice_model.html">Invoice Model</a></li> 
							<li class="reference"><a href="./../developers/reference/head_assets_library.html">Head Assets Library</a></li> 
							<li class="reference"><a href="./../developers/reference/link_model.html">Link Model</a></li> 
							<li class="reference"><a href="./../developers/reference/login_model.html">Login Model</a></li> 
							<li class="reference"><a href="./../developers/reference/menu_model.html">Menu Model</a></li> 
							<li class="reference"><a href="./../developers/reference/notices_library.html">Notices Library</a></li>
							<li class="reference"><a href="./../developers/reference/order_model.html">Order Model</a></li>  
							<li class="reference"><a href="./../developers/reference/products_model.html">Products Model</a></li> 
							<li class="reference"><a href="./../developers/reference/usergroup_model.html">Usergroup Model</a></li> 
							<li class="reference"><a href="./../developers/reference/product_option_model.html">Product Option Model</a></li>
							<li class="reference"><a href="./../developers/reference/rss_model.html">RSS Model</a></li> 
							<li class="reference"><a href="./../developers/reference/setting_helper.html">Setting Helper</a></li>
							<li class="reference"><a href="./../developers/reference/settings_model.html">Settings Model</a></li> 
							<li class="reference"><a href="./../developers/reference/shipping_model.html">Shipping Model</a></li> 
							<li class="reference"><a href="./../developers/reference/states_model.html">States Model</a></li> 
							<li class="reference"><a href="./../developers/reference/stats_library.html">Stats Library</a></li> 
							<li class="reference"><a href="./../developers/reference/subscription_model.html">Subscription Model</a></li> 
							<li class="reference"><a href="./../developers/reference/subscription_plan_model.html">Subscription Plan Model</a></li> 
							<li class="reference"><a href="./../developers/reference/taxes_model.html">Taxes Model</a></li> 
							<li class="reference"><a href="./../developers/reference/template_files_helper.html">Template Files Helper</a></li> 
							<li class="reference"><a href="./../developers/reference/theme_model.html">Theme Model</a></li>
							<li class="reference"><a href="./../developers/reference/time_since_helper.html">Time Since Helper</a></li> 
							<li class="reference"><a href="./../developers/reference/topic_model.html">Topic Model</a></li> 
							<li class="reference"><a href="./../developers/reference/url_helper.html">URL Helper</a></li> 
							<li class="reference"><a href="./../developers/reference/user_model.html">User Model</a></li> 
							<li class="reference"><a href="./../developers/reference/usergroup_model.html">Usergroup Model</a></li> 
						</ul>
						
					</li>
				</ul>
			</div>
			<div id="content">
				<h1>Template Plugins</h1>

<p>Hero offers a variety of template plugins out-of-the-box that can be used throughout your template files to do things like retrieve content, access setting values, and generate proper URL's.</p>

<p>However, developers can also create their <i>own</i> template plugins.  Template plugins can be included:</p>

<ul>
<li>In a module folder at <span class="filename">/app/modules/yourmodule/template_plugins/</span>, when the folder is referenced in the <a href="./../developers/modules.html">module definition file</a> in the <span class="code">front_preload()</span> section.</li>
<li>In a theme folder, at <span class="filename">/themes/yourtheme/plugins/</span>.</li>
<li>In the common plugins folder, at <span class="filename">/themes/_plugins/</span>.</li>
</ul>

<h2>Function Plugins vs. Block Plugins</h2>

<strong>Functions</strong> are template plugins like <span class="code">{setting name=&quot;site_name&quot;}</span> <a href="./../designers/reference/global_plugins.html">documented here</a>.  They only include one tag and return a string of data (or empty string) upon their call.  Function plugins are defined in files named <span class="filename">function.yourfunction.php</span> and share a common function structure:

<pre class="code brush: php">

function smarty_function_yourfunction ($params, &amp;$smarty) {
	// function code
}

</pre>

<p>More information on creating template functions can be found at <a href="http://www.smarty.net">Smarty's documentation</a>.</p>

<strong>Blocks</strong> are template plugins that include an opening and closing tag, like:

<pre class="code brush: php">

{restricted in_group=&quot;3&quot;}
This content is shown to those in group #3.
{/restricted}

</pre>

<p>They, like function plugins, can be passed parameters which alter their execution.  However, unlike functions, they are also passed the content between the two tags and can manipulate it, return it, or discard it as they wish.</p>

<p>Block plugins are defined in files named <span class="filename">block.yourblock.php</span> and share a common function structure:</p>

<pre class="code brush: php">

function smarty_block_yourblock ($params, $tagdata, &amp;$smarty, &amp;$repeat){	
	// do what you will with the $params array and $tagdata string
}

</pre>

<h2>Accessing the application superobject</h2>

<p>Within template functions and blocks, you can access the CodeIgniter superobject (and all of its libraries, models, and methods) at <span class="code">$smarty-&gt;CI</span>.  For example, to make a database call within a template plugin:</p>

<pre class="code brush: php">

function smarty_function_myfunction ($params, &amp;$smarty) {
	$smarty-&gt;CI-&gt;db-&gt;select('my_id');
	$result = $smarty-&gt;CI-&gt;db-&gt;get('my_table');
	
	// etc...
}

</pre>

<a href="./../developers/codeigniter.html">More information on the superobject is here</a>.

<h2>Looping through data in a block plugin</h2>

<p>Many block plugins allow designers to retrieve X number of items from the database and loop through/display these items within the template.  The items are displayed through template variables contained between the block plugin's opening and closing tags.  <a href="./../designers/smarty.html">Smarty</a> makes this looping/variable assignment possible, but it's not very easy.</p>

<p>Hero includes a proprietary library extension (<strong>loop_data</strong>) for Smarty that makes looping through data within a block plugin much easier.  As an example, we have the <a href="./../designers/reference/publish.html">{topics}</a> template plugin.  This plugin retrieves your site's defined topics within your templates:</p>

<pre class="code brush: php">

function smarty_block_topics ($params, $tagdata, &amp;$smarty, &amp;$repeat){
	if (!isset($params['var'])) {
		show_error('You must specify a &quot;var&quot; parameter for template {topics} calls.  This parameter specifies the variable name for the returned array.');
	}
	// deal with filters
	$filters = array();
	
	// param: sort
	if (isset($params['sort'])) {
		$filters['sort'] = $params['sort'];
	}
	
	// param: sort_dir
	if (isset($params['sort_dir'])) {
		$filters['sort_dir'] = $params['sort_dir'];
	}
	
	// param: limit
	if (isset($params['limit'])) {
		$filters['limit'] = $params['limit'];
	}
	
	// param: offset
	if (isset($params['offset'])) {
		$filters['offset'] = $params['offset'];
	}
	
	// initialize block loop
	$data_name = $smarty-&gt;CI-&gt;smarty-&gt;loop_data_key($filters);
	
	if ($smarty-&gt;CI-&gt;smarty-&gt;loop_data($data_name) === FALSE) {
		// make content request
		$smarty-&gt;CI-&gt;load-&gt;model('publish/topic_model');
		$topics = $smarty-&gt;CI-&gt;topic_model-&gt;get_topics($filters);
	}
	else {
		$topics = FALSE;
	}
	
	$smarty-&gt;CI-&gt;smarty-&gt;block_loop($data_name, $topics, (string)$params['var'], $repeat);
			
	echo $tagdata;
}

</pre>

<p>Most of the code above deals with building the <span class="code">$filters</span> array from the tag parameters for the <span class="code">get_topics()</span> call.  However, after that, we see the "loop_data" calls that make the recursive magic happen.</p>

<strong>First, we generate a unique key based on the filters in the call</strong> with <span class="code">$smarty-&gt;CI-&gt;loop_data_key()</span>.  Because, through recursion, this function will be called repeatedly, this key is used later to store the returned data from <span class="code">get_topics()</span> so that we don't begin an infinite loop of retrieving topics.

<strong>Second, we check to see if data has already been cached for this request</strong> with <span class="code">$smarty-&gt;CI-&gt;loop_data()</span>.  If this method returns <span class="code">FALSE</span>, no content has yet been retrieved (i.e., this is our first time executing this function).

<strong>Third, if the previous method returns FALSE and we don't have any data</strong>, we retrieve the data and store it in a variable.  In this case, we populate the <span class="code">$topics</span> variable with the data retrieved from <span class="code">get_topics()</span>.  <strong>If we already had loop data,</strong> we set <span class="code">$topics = FALSE</span>.  In doing so, the next method knows to retrieve data from the cache.

<strong>Finally, we call the magic method</strong>, <span class="code">$smarty-&gt;CI-&gt;block_loop()</span>, which will do the rest of the looping and variable assignment for us.  The four parameters should be passed as-is, with only the second variable being customized to refer to the data we retrieved in step 3.
			</div>
		</div>
	</body>
</html>
<!-- /developers-->